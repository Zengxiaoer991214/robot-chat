# 添加 Global Agent (公共模型) 功能规划

为了实现您想要的“公共模型”功能，我们需要打通后端数据库到前端展示的全链路。以下是详细的实施方案。

## 1. 数据库与后端改造 (Backend)

### A. 数据库模型 (`models`)
在 `Agent` 表中新增一个字段：
- `is_global`: `Boolean` 类型，默认为 `False`。
  - `True`: 表示公共模型，所有人可见。
  - `False`: 表示私有模型，仅创建者可见。

### B. API 接口逻辑 (`api/agents.py`)
需要修改核心的增删改查逻辑：
1.  **查询列表 (`GET /agents`)**:
    - 原逻辑：`User.id == current_user.id`
    - 新逻辑：`(User.id == current_user.id) OR (Agent.is_global == True)`
    - **效果**: 用户既能看到自己的模型，也能看到公共模型。
2.  **创建/更新 (`POST/PATCH`)**:
    - 允许用户（或管理员）设置 `is_global` 字段。
3.  **删除/修改权限 (`DELETE/PATCH`)**:
    - **关键逻辑**: 只有 **创建者** 才能删除或修改该 Agent。
    - 如果普通用户尝试删除一个公共 Agent，接口将返回 `403 Forbidden`。

### C. 鉴权增强 (`api/auth.py`)
为了让前端知道“我是谁”，我们需要优化登录接口：
- **登录响应**: 除了返回 Token，额外返回 `user_id` 和 `username`。
- **前端存储**: 前端将 `user_id` 存入 LocalStorage，用于判断“这个 Agent 是不是我造的”。

---

## 2. 前端界面设计 (Frontend UI)

针对您提到的“页面怎么弄”的问题，我建议采用 **“统一列表 + 视觉区分”** 的方案，既简单又直观：

### A. 列表展示 (`AgentManagement.vue`)
不需要拆分成两个复杂的 Tab，直接在现有网格列表中展示所有模型：
- **公共模型**: 卡片右上角增加一个 **🌍 Global (公共)** 的徽章/标签。
- **私有模型**: 保持原样，或者标记为 👤 Private。

### B. 权限控制 (交互体验)
- **如果是我的模型**: 显示 [编辑] 和 [删除] 按钮。
- **如果是别人的公共模型**:
    - **隐藏** [删除] 按钮。
    - 将 [编辑] 按钮替换为 [查看详情] (View Details) 或者直接禁用，防止误操作。

### C. 创建/编辑弹窗
- 新增一个 **"设为公共模型" (Set as Global)** 的开关/复选框。
- 只有勾选后，其他用户才能看到。

---

## 3. 实施步骤 (Execution Steps)

1.  **后端**: 修改 `Agent` 模型和 Pydantic Schema，生成数据库迁移脚本。
2.  **后端**: 升级 `auth` 接口返回用户信息，升级 `agents` 接口支持 global 查询。
3.  **前端**: 更新 API 服务，存储 User ID。
4.  **前端**: 改造 `AgentManagement.vue` 界面，增加徽章和权限判断逻辑。
